{"ast":null,"code":"/*global console */\nvar utils = require('../../../utils');\n/**\n * @class\n * @memberof PIXI\n * @param shaderManager {ShaderManager} The webgl shader manager this shader works for.\n * @param [vertexSrc] {string} The source of the vertex shader.\n * @param [fragmentSrc] {string} The source of the fragment shader.\n * @param [uniforms] {object} Uniforms for this shader.\n * @param [attributes] {object} Attributes for this shader.\n */\n\n\nfunction Shader(shaderManager, vertexSrc, fragmentSrc, uniforms, attributes) {\n  if (!vertexSrc || !fragmentSrc) {\n    throw new Error('Pixi.js Error. Shader requires vertexSrc and fragmentSrc');\n  }\n  /**\n   * A unique id\n   * @member {number}\n   * @readonly\n   */\n\n\n  this.uid = utils.uid();\n  /**\n   * The current WebGL drawing context\n   * @member {WebGLRenderingContext}\n   * @readonly\n   */\n\n  this.gl = shaderManager.renderer.gl; //TODO maybe we should pass renderer rather than shader manger?? food for thought..\n\n  this.shaderManager = shaderManager;\n  /**\n   * The WebGL program.\n   *\n   * @member {WebGLProgram}\n   * @readonly\n   */\n\n  this.program = null;\n  /**\n   * The uniforms as an object\n   * @member {object}\n   * @private\n   */\n\n  this.uniforms = uniforms || {};\n  /**\n   * The attributes as an object\n   * @member {object}\n   * @private\n   */\n\n  this.attributes = attributes || {};\n  /**\n   * Internal texture counter\n   * @member {number}\n   * @private\n   */\n\n  this.textureCount = 1;\n  /**\n   * The vertex shader as an array of strings\n   *\n   * @member {string}\n   */\n\n  this.vertexSrc = vertexSrc;\n  /**\n   * The fragment shader as an array of strings\n   *\n   * @member {string}\n   */\n\n  this.fragmentSrc = fragmentSrc;\n  this.init();\n}\n\nShader.prototype.constructor = Shader;\nmodule.exports = Shader;\n/*\n * Creates the shader and uses it\n *\n */\n\nShader.prototype.init = function () {\n  this.compile();\n  this.gl.useProgram(this.program);\n  this.cacheUniformLocations(Object.keys(this.uniforms));\n  this.cacheAttributeLocations(Object.keys(this.attributes));\n};\n/*\n * Caches the locations of the uniform for reuse\n * @param keys {string} the uniforms to cache\n */\n\n\nShader.prototype.cacheUniformLocations = function (keys) {\n  for (var i = 0; i < keys.length; ++i) {\n    this.uniforms[keys[i]]._location = this.gl.getUniformLocation(this.program, keys[i]);\n  }\n};\n/*\n * Caches the locations of the attribute for reuse\n * @param keys {string} the attributes to cache\n */\n\n\nShader.prototype.cacheAttributeLocations = function (keys) {\n  for (var i = 0; i < keys.length; ++i) {\n    this.attributes[keys[i]] = this.gl.getAttribLocation(this.program, keys[i]);\n  } // TODO: Check if this is needed anymore...\n  // Begin worst hack eva //\n  // WHY??? ONLY on my chrome pixel the line above returns -1 when using filters?\n  // maybe its something to do with the current state of the gl context.\n  // I'm convinced this is a bug in the chrome browser as there is NO reason why this should be returning -1 especially as it only manifests on my chrome pixel\n  // If theres any webGL people that know why could happen please help :)\n  // if (this.attributes.aColor === -1){\n  //     this.attributes.aColor = 2;\n  // }\n  // End worst hack eva //\n\n};\n/*\n * Attaches the shaders and creates the program\n * @return {WebGLProgram}\n */\n\n\nShader.prototype.compile = function () {\n  var gl = this.gl;\n\n  var glVertShader = this._glCompile(gl.VERTEX_SHADER, this.vertexSrc);\n\n  var glFragShader = this._glCompile(gl.FRAGMENT_SHADER, this.fragmentSrc);\n\n  var program = gl.createProgram();\n  gl.attachShader(program, glVertShader);\n  gl.attachShader(program, glFragShader);\n  gl.linkProgram(program); // if linking fails, then log and cleanup\n\n  if (!gl.getProgramParameter(program, gl.LINK_STATUS)) {\n    console.error('Pixi.js Error: Could not initialize shader.');\n    console.error('gl.VALIDATE_STATUS', gl.getProgramParameter(program, gl.VALIDATE_STATUS));\n    console.error('gl.getError()', gl.getError()); // if there is a program info log, log it\n\n    if (gl.getProgramInfoLog(program) !== '') {\n      console.warn('Pixi.js Warning: gl.getProgramInfoLog()', gl.getProgramInfoLog(program));\n    }\n\n    gl.deleteProgram(program);\n    program = null;\n  } // clean up some shaders\n\n\n  gl.deleteShader(glVertShader);\n  gl.deleteShader(glFragShader);\n  return this.program = program;\n};\n/*\nShader.prototype.buildSync = function ()\n{\n   // var str = \"\"\n\n   // str =  \"Shader.prototype.syncUniforms = function()\";\n   // str += \"{\\n\";\n\n    for (var key in this.uniforms)\n    {\n        var uniform = this.uniforms[key];\n\n        Object.defineProperty(this, key, {\n\n            get: function ()\n            {\n                return uniform.value\n            },\n            set: function (value)\n            {\n                this.setUniform(uniform, value);\n            }\n        });\n\n        console.log( makePropSetter( key, \" bloop\", uniform.type )  )\n  //      Object.def\n        //    location = uniform._location,\n          //  value = uniform.value,\n            //i, il;\n\n    //    str += \"gl.uniform1i(this.uniforms.\"+ key +\"._location, this.uniforms.\" + key + \".value );\\n\"\n\n    }\n\n}*/\n\n/**\n* Adds a new uniform\n*\n* @param uniform {Object} the new uniform to attach\n*/\n\n\nShader.prototype.syncUniform = function (uniform) {\n  var location = uniform._location,\n      value = uniform.value,\n      gl = this.gl,\n      i,\n      il;\n\n  switch (uniform.type) {\n    case 'b':\n    case 'bool':\n    case 'boolean':\n      gl.uniform1i(location, value ? 1 : 0);\n      break;\n    // single int value\n\n    case 'i':\n    case '1i':\n      gl.uniform1i(location, value);\n      break;\n    // single float value\n\n    case 'f':\n    case '1f':\n      gl.uniform1f(location, value);\n      break;\n    // Float32Array(2) or JS Arrray\n\n    case '2f':\n      gl.uniform2f(location, value[0], value[1]);\n      break;\n    // Float32Array(3) or JS Arrray\n\n    case '3f':\n      gl.uniform3f(location, value[0], value[1], value[2]);\n      break;\n    // Float32Array(4) or JS Arrray\n\n    case '4f':\n      gl.uniform4f(location, value[0], value[1], value[2], value[3]);\n      break;\n    // a 2D Point object\n\n    case 'v2':\n      gl.uniform2f(location, value.x, value.y);\n      break;\n    // a 3D Point object\n\n    case 'v3':\n      gl.uniform3f(location, value.x, value.y, value.z);\n      break;\n    // a 4D Point object\n\n    case 'v4':\n      gl.uniform4f(location, value.x, value.y, value.z, value.w);\n      break;\n    // Int32Array or JS Array\n\n    case '1iv':\n      gl.uniform1iv(location, value);\n      break;\n    // Int32Array or JS Array\n\n    case '2iv':\n      gl.uniform2iv(location, value);\n      break;\n    // Int32Array or JS Array\n\n    case '3iv':\n      gl.uniform3iv(location, value);\n      break;\n    // Int32Array or JS Array\n\n    case '4iv':\n      gl.uniform4iv(location, value);\n      break;\n    // Float32Array or JS Array\n\n    case '1fv':\n      gl.uniform1fv(location, value);\n      break;\n    // Float32Array or JS Array\n\n    case '2fv':\n      gl.uniform2fv(location, value);\n      break;\n    // Float32Array or JS Array\n\n    case '3fv':\n      gl.uniform3fv(location, value);\n      break;\n    // Float32Array or JS Array\n\n    case '4fv':\n      gl.uniform4fv(location, value);\n      break;\n    // Float32Array or JS Array\n\n    case 'm2':\n    case 'mat2':\n    case 'Matrix2fv':\n      gl.uniformMatrix2fv(location, uniform.transpose, value);\n      break;\n    // Float32Array or JS Array\n\n    case 'm3':\n    case 'mat3':\n    case 'Matrix3fv':\n      gl.uniformMatrix3fv(location, uniform.transpose, value);\n      break;\n    // Float32Array or JS Array\n\n    case 'm4':\n    case 'mat4':\n    case 'Matrix4fv':\n      gl.uniformMatrix4fv(location, uniform.transpose, value);\n      break;\n    // a Color Value\n\n    case 'c':\n      if (typeof value === 'number') {\n        value = utils.hex2rgb(value);\n      }\n\n      gl.uniform3f(location, value[0], value[1], value[2]);\n      break;\n    // flat array of integers (JS or typed array)\n\n    case 'iv1':\n      gl.uniform1iv(location, value);\n      break;\n    // flat array of integers with 3 x N size (JS or typed array)\n\n    case 'iv':\n      gl.uniform3iv(location, value);\n      break;\n    // flat array of floats (JS or typed array)\n\n    case 'fv1':\n      gl.uniform1fv(location, value);\n      break;\n    // flat array of floats with 3 x N size (JS or typed array)\n\n    case 'fv':\n      gl.uniform3fv(location, value);\n      break;\n    // array of 2D Point objects\n\n    case 'v2v':\n      if (!uniform._array) {\n        uniform._array = new Float32Array(2 * value.length);\n      }\n\n      for (i = 0, il = value.length; i < il; ++i) {\n        uniform._array[i * 2] = value[i].x;\n        uniform._array[i * 2 + 1] = value[i].y;\n      }\n\n      gl.uniform2fv(location, uniform._array);\n      break;\n    // array of 3D Point objects\n\n    case 'v3v':\n      if (!uniform._array) {\n        uniform._array = new Float32Array(3 * value.length);\n      }\n\n      for (i = 0, il = value.length; i < il; ++i) {\n        uniform._array[i * 3] = value[i].x;\n        uniform._array[i * 3 + 1] = value[i].y;\n        uniform._array[i * 3 + 2] = value[i].z;\n      }\n\n      gl.uniform3fv(location, uniform._array);\n      break;\n    // array of 4D Point objects\n\n    case 'v4v':\n      if (!uniform._array) {\n        uniform._array = new Float32Array(4 * value.length);\n      }\n\n      for (i = 0, il = value.length; i < il; ++i) {\n        uniform._array[i * 4] = value[i].x;\n        uniform._array[i * 4 + 1] = value[i].y;\n        uniform._array[i * 4 + 2] = value[i].z;\n        uniform._array[i * 4 + 3] = value[i].w;\n      }\n\n      gl.uniform4fv(location, uniform._array);\n      break;\n    // PIXI.Texture\n\n    case 't':\n    case 'sampler2D':\n      if (!uniform.value || !uniform.value.baseTexture.hasLoaded) {\n        break;\n      } // activate this texture\n\n\n      gl.activeTexture(gl['TEXTURE' + this.textureCount]);\n      var texture = uniform.value.baseTexture._glTextures[gl.id];\n\n      if (!texture) {\n        this.initSampler2D(uniform); // set the textur to the newly created one..\n\n        texture = uniform.value.baseTexture._glTextures[gl.id];\n      } // bind the texture\n\n\n      gl.bindTexture(gl.TEXTURE_2D, texture); // set uniform to texture index\n\n      gl.uniform1i(uniform._location, this.textureCount); // increment next texture id\n\n      this.textureCount++;\n      break;\n\n    default:\n      console.warn('Pixi.js Shader Warning: Unknown uniform type: ' + uniform.type);\n  }\n};\n/*\n * Updates the shader uniform values.\n */\n\n\nShader.prototype.syncUniforms = function () {\n  this.textureCount = 1;\n\n  for (var key in this.uniforms) {\n    this.syncUniform(this.uniforms[key]);\n  }\n};\n/**\n * Initialises a Sampler2D uniform (which may only be available later on after initUniforms once the texture has loaded)\n *\n */\n\n\nShader.prototype.initSampler2D = function (uniform) {\n  var gl = this.gl;\n  var texture = uniform.value.baseTexture;\n\n  if (!texture.hasLoaded) {\n    return;\n  }\n\n  if (uniform.textureData) {\n    //TODO move this...\n    var data = uniform.textureData;\n    texture._glTextures[gl.id] = gl.createTexture();\n    gl.bindTexture(gl.TEXTURE_2D, texture._glTextures[gl.id]);\n    gl.pixelStorei(gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL, texture.premultipliedAlpha); // GLTexture = mag linear, min linear_mipmap_linear, wrap repeat + gl.generateMipmap(gl.TEXTURE_2D);\n    // GLTextureLinear = mag/min linear, wrap clamp\n    // GLTextureNearestRepeat = mag/min NEAREST, wrap repeat\n    // GLTextureNearest = mag/min nearest, wrap clamp\n    // AudioTexture = whatever + luminance + width 512, height 2, border 0\n    // KeyTexture = whatever + luminance + width 256, height 2, border 0\n    //  magFilter can be: gl.LINEAR, gl.LINEAR_MIPMAP_LINEAR or gl.NEAREST\n    //  wrapS/T can be: gl.CLAMP_TO_EDGE or gl.REPEAT\n\n    gl.texImage2D(gl.TEXTURE_2D, 0, data.luminance ? gl.LUMINANCE : gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, texture.source);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, data.magFilter ? data.magFilter : gl.LINEAR);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, data.wrapS ? data.wrapS : gl.CLAMP_TO_EDGE);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, data.wrapS ? data.wrapS : gl.CLAMP_TO_EDGE);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, data.wrapT ? data.wrapT : gl.CLAMP_TO_EDGE);\n  } else {\n    this.shaderManager.renderer.updateTexture(texture);\n  }\n};\n/**\n * Destroys the shader.\n *\n */\n\n\nShader.prototype.destroy = function () {\n  this.gl.deleteProgram(this.program);\n  this.gl = null;\n  this.uniforms = null;\n  this.attributes = null;\n  this.vertexSrc = null;\n  this.fragmentSrc = null;\n};\n\nShader.prototype._glCompile = function (type, src) {\n  var shader = this.gl.createShader(type);\n  this.gl.shaderSource(shader, src);\n  this.gl.compileShader(shader);\n\n  if (!this.gl.getShaderParameter(shader, this.gl.COMPILE_STATUS)) {\n    console.log(this.gl.getShaderInfoLog(shader));\n    return null;\n  }\n\n  return shader;\n};","map":{"version":3,"sources":["/Users/thebe/Desktop/music-generator-app/node_modules/pixi.js/src/core/renderers/webgl/shaders/Shader.js"],"names":["utils","require","Shader","shaderManager","vertexSrc","fragmentSrc","uniforms","attributes","Error","uid","gl","renderer","program","textureCount","init","prototype","constructor","module","exports","compile","useProgram","cacheUniformLocations","Object","keys","cacheAttributeLocations","i","length","_location","getUniformLocation","getAttribLocation","glVertShader","_glCompile","VERTEX_SHADER","glFragShader","FRAGMENT_SHADER","createProgram","attachShader","linkProgram","getProgramParameter","LINK_STATUS","console","error","VALIDATE_STATUS","getError","getProgramInfoLog","warn","deleteProgram","deleteShader","syncUniform","uniform","location","value","il","type","uniform1i","uniform1f","uniform2f","uniform3f","uniform4f","x","y","z","w","uniform1iv","uniform2iv","uniform3iv","uniform4iv","uniform1fv","uniform2fv","uniform3fv","uniform4fv","uniformMatrix2fv","transpose","uniformMatrix3fv","uniformMatrix4fv","hex2rgb","_array","Float32Array","baseTexture","hasLoaded","activeTexture","texture","_glTextures","id","initSampler2D","bindTexture","TEXTURE_2D","syncUniforms","key","textureData","data","createTexture","pixelStorei","UNPACK_PREMULTIPLY_ALPHA_WEBGL","premultipliedAlpha","texImage2D","luminance","LUMINANCE","RGBA","UNSIGNED_BYTE","source","texParameteri","TEXTURE_MAG_FILTER","magFilter","LINEAR","TEXTURE_MIN_FILTER","wrapS","CLAMP_TO_EDGE","TEXTURE_WRAP_T","TEXTURE_WRAP_S","wrapT","updateTexture","destroy","src","shader","createShader","shaderSource","compileShader","getShaderParameter","COMPILE_STATUS","log","getShaderInfoLog"],"mappings":"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","sourcesContent":["/*global console */\nvar utils = require('../../../utils');\n\n/**\n * @class\n * @memberof PIXI\n * @param shaderManager {ShaderManager} The webgl shader manager this shader works for.\n * @param [vertexSrc] {string} The source of the vertex shader.\n * @param [fragmentSrc] {string} The source of the fragment shader.\n * @param [uniforms] {object} Uniforms for this shader.\n * @param [attributes] {object} Attributes for this shader.\n */\nfunction Shader(shaderManager, vertexSrc, fragmentSrc, uniforms, attributes)\n{\n    if (!vertexSrc || !fragmentSrc)\n    {\n         throw new Error('Pixi.js Error. Shader requires vertexSrc and fragmentSrc');\n    }\n\n    /**\n     * A unique id\n     * @member {number}\n     * @readonly\n     */\n    this.uid = utils.uid();\n\n    /**\n     * The current WebGL drawing context\n     * @member {WebGLRenderingContext}\n     * @readonly\n     */\n    this.gl = shaderManager.renderer.gl;\n\n    //TODO maybe we should pass renderer rather than shader manger?? food for thought..\n    this.shaderManager = shaderManager;\n\n    /**\n     * The WebGL program.\n     *\n     * @member {WebGLProgram}\n     * @readonly\n     */\n    this.program = null;\n\n    /**\n     * The uniforms as an object\n     * @member {object}\n     * @private\n     */\n    this.uniforms = uniforms || {};\n\n    /**\n     * The attributes as an object\n     * @member {object}\n     * @private\n     */\n    this.attributes = attributes || {};\n\n    /**\n     * Internal texture counter\n     * @member {number}\n     * @private\n     */\n    this.textureCount = 1;\n\n    /**\n     * The vertex shader as an array of strings\n     *\n     * @member {string}\n     */\n    this.vertexSrc = vertexSrc;\n\n    /**\n     * The fragment shader as an array of strings\n     *\n     * @member {string}\n     */\n    this.fragmentSrc = fragmentSrc;\n\n    this.init();\n}\n\nShader.prototype.constructor = Shader;\nmodule.exports = Shader;\n\n/*\n * Creates the shader and uses it\n *\n */\nShader.prototype.init = function ()\n{\n    this.compile();\n\n    this.gl.useProgram(this.program);\n\n    this.cacheUniformLocations(Object.keys(this.uniforms));\n    this.cacheAttributeLocations(Object.keys(this.attributes));\n};\n\n/*\n * Caches the locations of the uniform for reuse\n * @param keys {string} the uniforms to cache\n */\nShader.prototype.cacheUniformLocations = function (keys)\n{\n    for (var i = 0; i < keys.length; ++i)\n    {\n        this.uniforms[keys[i]]._location = this.gl.getUniformLocation(this.program, keys[i]);\n    }\n};\n\n/*\n * Caches the locations of the attribute for reuse\n * @param keys {string} the attributes to cache\n */\nShader.prototype.cacheAttributeLocations = function (keys)\n{\n    for (var i = 0; i < keys.length; ++i)\n    {\n        this.attributes[keys[i]] = this.gl.getAttribLocation(this.program, keys[i]);\n    }\n\n    // TODO: Check if this is needed anymore...\n\n    // Begin worst hack eva //\n\n    // WHY??? ONLY on my chrome pixel the line above returns -1 when using filters?\n    // maybe its something to do with the current state of the gl context.\n    // I'm convinced this is a bug in the chrome browser as there is NO reason why this should be returning -1 especially as it only manifests on my chrome pixel\n    // If theres any webGL people that know why could happen please help :)\n    // if (this.attributes.aColor === -1){\n    //     this.attributes.aColor = 2;\n    // }\n\n    // End worst hack eva //\n};\n\n/*\n * Attaches the shaders and creates the program\n * @return {WebGLProgram}\n */\nShader.prototype.compile = function ()\n{\n    var gl = this.gl;\n\n    var glVertShader = this._glCompile(gl.VERTEX_SHADER, this.vertexSrc);\n    var glFragShader = this._glCompile(gl.FRAGMENT_SHADER, this.fragmentSrc);\n\n    var program = gl.createProgram();\n\n    gl.attachShader(program, glVertShader);\n    gl.attachShader(program, glFragShader);\n    gl.linkProgram(program);\n\n    // if linking fails, then log and cleanup\n    if (!gl.getProgramParameter(program, gl.LINK_STATUS))\n    {\n        console.error('Pixi.js Error: Could not initialize shader.');\n        console.error('gl.VALIDATE_STATUS', gl.getProgramParameter(program, gl.VALIDATE_STATUS));\n        console.error('gl.getError()', gl.getError());\n\n        // if there is a program info log, log it\n        if (gl.getProgramInfoLog(program) !== '')\n        {\n            console.warn('Pixi.js Warning: gl.getProgramInfoLog()', gl.getProgramInfoLog(program));\n        }\n\n        gl.deleteProgram(program);\n        program = null;\n    }\n\n    // clean up some shaders\n    gl.deleteShader(glVertShader);\n    gl.deleteShader(glFragShader);\n\n    return (this.program = program);\n};\n\n/*\nShader.prototype.buildSync = function ()\n{\n   // var str = \"\"\n\n   // str =  \"Shader.prototype.syncUniforms = function()\";\n   // str += \"{\\n\";\n\n    for (var key in this.uniforms)\n    {\n        var uniform = this.uniforms[key];\n\n        Object.defineProperty(this, key, {\n\n            get: function ()\n            {\n                return uniform.value\n            },\n            set: function (value)\n            {\n                this.setUniform(uniform, value);\n            }\n        });\n\n        console.log( makePropSetter( key, \" bloop\", uniform.type )  )\n  //      Object.def\n        //    location = uniform._location,\n          //  value = uniform.value,\n            //i, il;\n\n    //    str += \"gl.uniform1i(this.uniforms.\"+ key +\"._location, this.uniforms.\" + key + \".value );\\n\"\n\n    }\n\n}*/\n\n/**\n* Adds a new uniform\n*\n* @param uniform {Object} the new uniform to attach\n*/\nShader.prototype.syncUniform = function (uniform)\n{\n    var location = uniform._location,\n        value = uniform.value,\n        gl = this.gl,\n        i, il;\n\n    switch (uniform.type)\n    {\n        case 'b':\n        case 'bool':\n        case 'boolean':\n            gl.uniform1i(location, value ? 1 : 0);\n            break;\n\n        // single int value\n        case 'i':\n        case '1i':\n            gl.uniform1i(location, value);\n            break;\n\n        // single float value\n        case 'f':\n        case '1f':\n            gl.uniform1f(location, value);\n            break;\n\n        // Float32Array(2) or JS Arrray\n        case '2f':\n            gl.uniform2f(location, value[0], value[1]);\n            break;\n\n        // Float32Array(3) or JS Arrray\n        case '3f':\n            gl.uniform3f(location, value[0], value[1], value[2]);\n            break;\n\n        // Float32Array(4) or JS Arrray\n        case '4f':\n            gl.uniform4f(location, value[0], value[1], value[2], value[3]);\n            break;\n\n        // a 2D Point object\n        case 'v2':\n            gl.uniform2f(location, value.x, value.y);\n            break;\n\n        // a 3D Point object\n        case 'v3':\n            gl.uniform3f(location, value.x, value.y, value.z);\n            break;\n\n        // a 4D Point object\n        case 'v4':\n            gl.uniform4f(location, value.x, value.y, value.z, value.w);\n            break;\n\n        // Int32Array or JS Array\n        case '1iv':\n            gl.uniform1iv(location, value);\n            break;\n\n        // Int32Array or JS Array\n        case '2iv':\n            gl.uniform2iv(location, value);\n            break;\n\n        // Int32Array or JS Array\n        case '3iv':\n            gl.uniform3iv(location, value);\n            break;\n\n        // Int32Array or JS Array\n        case '4iv':\n            gl.uniform4iv(location, value);\n            break;\n\n        // Float32Array or JS Array\n        case '1fv':\n            gl.uniform1fv(location, value);\n            break;\n\n        // Float32Array or JS Array\n        case '2fv':\n            gl.uniform2fv(location, value);\n            break;\n\n        // Float32Array or JS Array\n        case '3fv':\n            gl.uniform3fv(location, value);\n            break;\n\n        // Float32Array or JS Array\n        case '4fv':\n            gl.uniform4fv(location, value);\n            break;\n\n        // Float32Array or JS Array\n        case 'm2':\n        case 'mat2':\n        case 'Matrix2fv':\n            gl.uniformMatrix2fv(location, uniform.transpose, value);\n            break;\n\n        // Float32Array or JS Array\n        case 'm3':\n        case 'mat3':\n        case 'Matrix3fv':\n\n            gl.uniformMatrix3fv(location, uniform.transpose, value);\n            break;\n\n        // Float32Array or JS Array\n        case 'm4':\n        case 'mat4':\n        case 'Matrix4fv':\n            gl.uniformMatrix4fv(location, uniform.transpose, value);\n            break;\n\n        // a Color Value\n        case 'c':\n            if (typeof value === 'number')\n            {\n                value = utils.hex2rgb(value);\n            }\n\n            gl.uniform3f(location, value[0], value[1], value[2]);\n            break;\n\n        // flat array of integers (JS or typed array)\n        case 'iv1':\n            gl.uniform1iv(location, value);\n            break;\n\n        // flat array of integers with 3 x N size (JS or typed array)\n        case 'iv':\n            gl.uniform3iv(location, value);\n            break;\n\n        // flat array of floats (JS or typed array)\n        case 'fv1':\n            gl.uniform1fv(location, value);\n            break;\n\n        // flat array of floats with 3 x N size (JS or typed array)\n        case 'fv':\n            gl.uniform3fv(location, value);\n            break;\n\n        // array of 2D Point objects\n        case 'v2v':\n            if (!uniform._array)\n            {\n                uniform._array = new Float32Array(2 * value.length);\n            }\n\n            for (i = 0, il = value.length; i < il; ++i)\n            {\n                uniform._array[i * 2]       = value[i].x;\n                uniform._array[i * 2 + 1]   = value[i].y;\n            }\n\n            gl.uniform2fv(location, uniform._array);\n            break;\n\n        // array of 3D Point objects\n        case 'v3v':\n            if (!uniform._array)\n            {\n                uniform._array = new Float32Array(3 * value.length);\n            }\n\n            for (i = 0, il = value.length; i < il; ++i)\n            {\n                uniform._array[i * 3]       = value[i].x;\n                uniform._array[i * 3 + 1]   = value[i].y;\n                uniform._array[i * 3 + 2]   = value[i].z;\n\n            }\n\n            gl.uniform3fv(location, uniform._array);\n            break;\n\n        // array of 4D Point objects\n        case 'v4v':\n            if (!uniform._array)\n            {\n                uniform._array = new Float32Array(4 * value.length);\n            }\n\n            for (i = 0, il = value.length; i < il; ++i)\n            {\n                uniform._array[i * 4]       = value[i].x;\n                uniform._array[i * 4 + 1]   = value[i].y;\n                uniform._array[i * 4 + 2]   = value[i].z;\n                uniform._array[i * 4 + 3]   = value[i].w;\n\n            }\n\n            gl.uniform4fv(location, uniform._array);\n            break;\n\n        // PIXI.Texture\n        case 't':\n        case 'sampler2D':\n\n            if (!uniform.value || !uniform.value.baseTexture.hasLoaded)\n            {\n                break;\n            }\n\n            // activate this texture\n            gl.activeTexture(gl['TEXTURE' + this.textureCount]);\n\n            var texture = uniform.value.baseTexture._glTextures[gl.id];\n\n            if (!texture)\n            {\n                this.initSampler2D(uniform);\n\n                // set the textur to the newly created one..\n                texture = uniform.value.baseTexture._glTextures[gl.id];\n            }\n\n            // bind the texture\n            gl.bindTexture(gl.TEXTURE_2D, texture);\n\n            // set uniform to texture index\n            gl.uniform1i(uniform._location, this.textureCount);\n\n            // increment next texture id\n            this.textureCount++;\n\n            break;\n\n        default:\n            console.warn('Pixi.js Shader Warning: Unknown uniform type: ' + uniform.type);\n    }\n};\n\n/*\n * Updates the shader uniform values.\n */\nShader.prototype.syncUniforms = function ()\n{\n    this.textureCount = 1;\n\n    for (var key in this.uniforms)\n    {\n        this.syncUniform(this.uniforms[key]);\n    }\n};\n\n\n/**\n * Initialises a Sampler2D uniform (which may only be available later on after initUniforms once the texture has loaded)\n *\n */\nShader.prototype.initSampler2D = function (uniform)\n{\n    var gl = this.gl;\n\n    var texture = uniform.value.baseTexture;\n\n    if(!texture.hasLoaded)\n    {\n        return;\n    }\n\n\n\n    if (uniform.textureData)\n    {\n\n        //TODO move this...\n        var data = uniform.textureData;\n\n        texture._glTextures[gl.id] = gl.createTexture();\n\n        gl.bindTexture(gl.TEXTURE_2D, texture._glTextures[gl.id]);\n\n        gl.pixelStorei(gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL, texture.premultipliedAlpha);\n        // GLTexture = mag linear, min linear_mipmap_linear, wrap repeat + gl.generateMipmap(gl.TEXTURE_2D);\n        // GLTextureLinear = mag/min linear, wrap clamp\n        // GLTextureNearestRepeat = mag/min NEAREST, wrap repeat\n        // GLTextureNearest = mag/min nearest, wrap clamp\n        // AudioTexture = whatever + luminance + width 512, height 2, border 0\n        // KeyTexture = whatever + luminance + width 256, height 2, border 0\n\n        //  magFilter can be: gl.LINEAR, gl.LINEAR_MIPMAP_LINEAR or gl.NEAREST\n        //  wrapS/T can be: gl.CLAMP_TO_EDGE or gl.REPEAT\n\n        gl.texImage2D(gl.TEXTURE_2D, 0, data.luminance ? gl.LUMINANCE : gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, texture.source);\n\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, data.magFilter ? data.magFilter : gl.LINEAR );\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, data.wrapS ? data.wrapS : gl.CLAMP_TO_EDGE );\n\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, data.wrapS ? data.wrapS : gl.CLAMP_TO_EDGE);\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, data.wrapT ? data.wrapT : gl.CLAMP_TO_EDGE);\n    }\n    else\n    {\n        this.shaderManager.renderer.updateTexture(texture);\n    }\n};\n\n/**\n * Destroys the shader.\n *\n */\nShader.prototype.destroy = function ()\n{\n    this.gl.deleteProgram(this.program);\n\n    this.gl = null;\n    this.uniforms = null;\n    this.attributes = null;\n\n    this.vertexSrc = null;\n    this.fragmentSrc = null;\n};\n\nShader.prototype._glCompile = function (type, src)\n{\n    var shader = this.gl.createShader(type);\n\n    this.gl.shaderSource(shader, src);\n    this.gl.compileShader(shader);\n\n    if (!this.gl.getShaderParameter(shader, this.gl.COMPILE_STATUS))\n    {\n        console.log(this.gl.getShaderInfoLog(shader));\n        return null;\n    }\n\n    return shader;\n};\n"]},"metadata":{},"sourceType":"script"}