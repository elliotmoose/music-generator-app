{"ast":null,"code":"var daccord = require('daccord');\n\nvar knowledge = require('./knowledge');\n\nvar Note = require('./note');\n\nvar Interval = require('./interval');\n\nfunction Chord(root, name) {\n  if (!(this instanceof Chord)) return new Chord(root, name);\n  name = name || '';\n  this.name = root.name().toUpperCase() + root.accidental() + name;\n  this.symbol = name;\n  this.root = root;\n  this.intervals = [];\n  this._voicing = [];\n  var bass = name.split('/');\n\n  if (bass.length === 2 && bass[1].trim() !== '9') {\n    name = bass[0];\n    bass = bass[1].trim();\n  } else {\n    bass = null;\n  }\n\n  this.intervals = daccord(name).map(Interval.toCoord);\n  this._voicing = this.intervals.slice();\n\n  if (bass) {\n    var intervals = this.intervals,\n        bassInterval,\n        note; // Make sure the bass is atop of the root note\n\n    note = Note.fromString(bass + (root.octave() + 1)); // crude\n\n    bassInterval = Interval.between(root, note);\n    bass = bassInterval.simple();\n    bassInterval = bassInterval.invert().direction('down');\n    this._voicing = [bassInterval];\n\n    for (var i = 0, length = intervals.length; i < length; i++) {\n      if (!intervals[i].simple().equal(bass)) this._voicing.push(intervals[i]);\n    }\n  }\n}\n\nChord.prototype = {\n  notes: function () {\n    var root = this.root;\n    return this.voicing().map(function (interval) {\n      return root.interval(interval);\n    });\n  },\n  simple: function () {\n    return this.notes().map(function (n) {\n      return n.toString(true);\n    });\n  },\n  bass: function () {\n    return this.root.interval(this._voicing[0]);\n  },\n  voicing: function (voicing) {\n    // Get the voicing\n    if (!voicing) {\n      return this._voicing;\n    } // Set the voicing\n\n\n    this._voicing = [];\n\n    for (var i = 0, length = voicing.length; i < length; i++) {\n      this._voicing[i] = Interval.toCoord(voicing[i]);\n    }\n\n    return this;\n  },\n  resetVoicing: function () {\n    this._voicing = this.intervals;\n  },\n  dominant: function (additional) {\n    additional = additional || '';\n    return new Chord(this.root.interval('P5'), additional);\n  },\n  subdominant: function (additional) {\n    additional = additional || '';\n    return new Chord(this.root.interval('P4'), additional);\n  },\n  parallel: function (additional) {\n    additional = additional || '';\n    var quality = this.quality();\n\n    if (this.chordType() !== 'triad' || quality === 'diminished' || quality === 'augmented') {\n      throw new Error('Only major/minor triads have parallel chords');\n    }\n\n    if (quality === 'major') {\n      return new Chord(this.root.interval('m3', 'down'), 'm');\n    } else {\n      return new Chord(this.root.interval('m3', 'up'));\n    }\n  },\n  quality: function () {\n    var third,\n        fifth,\n        seventh,\n        intervals = this.intervals;\n\n    for (var i = 0, length = intervals.length; i < length; i++) {\n      if (intervals[i].number() === 3) {\n        third = intervals[i];\n      } else if (intervals[i].number() === 5) {\n        fifth = intervals[i];\n      } else if (intervals[i].number() === 7) {\n        seventh = intervals[i];\n      }\n    }\n\n    if (!third) {\n      return;\n    }\n\n    third = third.direction() === 'down' ? third.invert() : third;\n    third = third.simple().toString();\n\n    if (fifth) {\n      fifth = fifth.direction === 'down' ? fifth.invert() : fifth;\n      fifth = fifth.simple().toString();\n    }\n\n    if (seventh) {\n      seventh = seventh.direction === 'down' ? seventh.invert() : seventh;\n      seventh = seventh.simple().toString();\n    }\n\n    if (third === 'M3') {\n      if (fifth === 'A5') {\n        return 'augmented';\n      } else if (fifth === 'P5') {\n        return seventh === 'm7' ? 'dominant' : 'major';\n      }\n\n      return 'major';\n    } else if (third === 'm3') {\n      if (fifth === 'P5') {\n        return 'minor';\n      } else if (fifth === 'd5') {\n        return seventh === 'm7' ? 'half-diminished' : 'diminished';\n      }\n\n      return 'minor';\n    }\n  },\n  chordType: function () {\n    // In need of better name\n    var length = this.intervals.length,\n        interval,\n        has,\n        invert,\n        i,\n        name;\n\n    if (length === 2) {\n      return 'dyad';\n    } else if (length === 3) {\n      has = {\n        first: false,\n        third: false,\n        fifth: false\n      };\n\n      for (i = 0; i < length; i++) {\n        interval = this.intervals[i];\n        invert = interval.invert();\n\n        if (interval.base() in has) {\n          has[interval.base()] = true;\n        } else if (invert.base() in has) {\n          has[invert.base()] = true;\n        }\n      }\n\n      name = has.first && has.third && has.fifth ? 'triad' : 'trichord';\n    } else if (length === 4) {\n      has = {\n        first: false,\n        third: false,\n        fifth: false,\n        seventh: false\n      };\n\n      for (i = 0; i < length; i++) {\n        interval = this.intervals[i];\n        invert = interval.invert();\n\n        if (interval.base() in has) {\n          has[interval.base()] = true;\n        } else if (invert.base() in has) {\n          has[invert.base()] = true;\n        }\n      }\n\n      if (has.first && has.third && has.fifth && has.seventh) {\n        name = 'tetrad';\n      }\n    }\n\n    return name || 'unknown';\n  },\n  get: function (interval) {\n    if (typeof interval === 'string' && interval in knowledge.stepNumber) {\n      var intervals = this.intervals,\n          i,\n          length;\n      interval = knowledge.stepNumber[interval];\n\n      for (i = 0, length = intervals.length; i < length; i++) {\n        if (intervals[i].number() === interval) {\n          return this.root.interval(intervals[i]);\n        }\n      }\n\n      return null;\n    } else {\n      throw new Error('Invalid interval name');\n    }\n  },\n  interval: function (interval) {\n    return new Chord(this.root.interval(interval), this.symbol);\n  },\n  transpose: function (interval) {\n    this.root.transpose(interval);\n    this.name = this.root.name().toUpperCase() + this.root.accidental() + this.symbol;\n    return this;\n  },\n  toString: function () {\n    return this.name;\n  }\n};\nmodule.exports = Chord;","map":{"version":3,"sources":["/Users/thebe/Desktop/music-generator-app/node_modules/teoria/lib/chord.js"],"names":["daccord","require","knowledge","Note","Interval","Chord","root","name","toUpperCase","accidental","symbol","intervals","_voicing","bass","split","length","trim","map","toCoord","slice","bassInterval","note","fromString","octave","between","simple","invert","direction","i","equal","push","prototype","notes","voicing","interval","n","toString","resetVoicing","dominant","additional","subdominant","parallel","quality","chordType","Error","third","fifth","seventh","number","has","first","base","get","stepNumber","transpose","module","exports"],"mappings":"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","sourcesContent":["var daccord = require('daccord');\nvar knowledge = require('./knowledge');\nvar Note = require('./note');\nvar Interval = require('./interval');\n\nfunction Chord(root, name) {\n  if (!(this instanceof Chord)) return new Chord(root, name);\n  name = name || '';\n  this.name = root.name().toUpperCase() + root.accidental() + name;\n  this.symbol = name;\n  this.root = root;\n  this.intervals = [];\n  this._voicing = [];\n\n  var bass = name.split('/');\n  if (bass.length === 2 && bass[1].trim() !== '9') {\n    name = bass[0];\n    bass = bass[1].trim();\n  } else {\n    bass = null;\n  }\n\n  this.intervals = daccord(name).map(Interval.toCoord)\n  this._voicing = this.intervals.slice();\n\n  if (bass) {\n    var intervals = this.intervals, bassInterval, note;\n    // Make sure the bass is atop of the root note\n    note = Note.fromString(bass + (root.octave() + 1)); // crude\n\n    bassInterval = Interval.between(root, note);\n    bass = bassInterval.simple();\n    bassInterval = bassInterval.invert().direction('down');\n\n    this._voicing = [bassInterval];\n    for (var i = 0, length = intervals.length;  i < length; i++) {\n      if (!intervals[i].simple().equal(bass))\n        this._voicing.push(intervals[i]);\n    }\n  }\n}\n\nChord.prototype = {\n  notes: function() {\n    var root = this.root;\n    return this.voicing().map(function(interval) {\n      return root.interval(interval);\n    });\n  },\n\n  simple: function() {\n    return this.notes().map(function(n) { return n.toString(true); });\n  },\n\n  bass: function() {\n    return this.root.interval(this._voicing[0]);\n  },\n\n  voicing: function(voicing) {\n    // Get the voicing\n    if (!voicing) {\n      return this._voicing;\n    }\n\n    // Set the voicing\n    this._voicing = [];\n    for (var i = 0, length = voicing.length; i < length; i++) {\n      this._voicing[i] = Interval.toCoord(voicing[i]);\n    }\n\n    return this;\n  },\n\n  resetVoicing: function() {\n    this._voicing = this.intervals;\n  },\n\n  dominant: function(additional) {\n    additional = additional || '';\n    return new Chord(this.root.interval('P5'), additional);\n  },\n\n  subdominant: function(additional) {\n    additional = additional || '';\n    return new Chord(this.root.interval('P4'), additional);\n  },\n\n  parallel: function(additional) {\n    additional = additional || '';\n    var quality = this.quality();\n\n    if (this.chordType() !== 'triad' || quality === 'diminished' ||\n        quality === 'augmented') {\n      throw new Error('Only major/minor triads have parallel chords');\n    }\n\n    if (quality === 'major') {\n      return new Chord(this.root.interval('m3', 'down'), 'm');\n    } else {\n      return new Chord(this.root.interval('m3', 'up'));\n    }\n  },\n\n  quality: function() {\n    var third, fifth, seventh, intervals = this.intervals;\n\n    for (var i = 0, length = intervals.length; i < length; i++) {\n      if (intervals[i].number() === 3) {\n        third = intervals[i];\n      } else if (intervals[i].number() === 5) {\n        fifth = intervals[i];\n      } else if (intervals[i].number() === 7) {\n        seventh = intervals[i];\n      }\n    }\n\n    if (!third) {\n      return;\n    }\n\n    third = (third.direction() === 'down') ? third.invert() : third;\n    third = third.simple().toString();\n\n    if (fifth) {\n      fifth = (fifth.direction === 'down') ? fifth.invert() : fifth;\n      fifth = fifth.simple().toString();\n    }\n\n    if (seventh) {\n      seventh = (seventh.direction === 'down') ? seventh.invert() : seventh;\n      seventh = seventh.simple().toString();\n    }\n\n    if (third === 'M3') {\n      if (fifth === 'A5') {\n        return 'augmented';\n      } else if (fifth === 'P5') {\n        return (seventh === 'm7') ? 'dominant' : 'major';\n      }\n\n      return 'major';\n    } else if (third === 'm3') {\n      if (fifth === 'P5') {\n        return 'minor';\n      } else if (fifth === 'd5') {\n        return (seventh === 'm7') ? 'half-diminished' : 'diminished';\n      }\n\n      return 'minor';\n    }\n  },\n\n  chordType: function() { // In need of better name\n    var length = this.intervals.length, interval, has, invert, i, name;\n\n    if (length === 2) {\n      return 'dyad';\n    } else if (length === 3) {\n      has = {first: false, third: false, fifth: false};\n      for (i = 0; i < length; i++) {\n        interval = this.intervals[i];\n        invert = interval.invert();\n        if (interval.base() in has) {\n          has[interval.base()] = true;\n        } else if (invert.base() in has) {\n          has[invert.base()] = true;\n        }\n      }\n\n      name = (has.first && has.third && has.fifth) ? 'triad' : 'trichord';\n    } else if (length === 4) {\n      has = {first: false, third: false, fifth: false, seventh: false};\n      for (i = 0; i < length; i++) {\n        interval = this.intervals[i];\n        invert = interval.invert();\n        if (interval.base() in has) {\n          has[interval.base()] = true;\n        } else if (invert.base() in has) {\n          has[invert.base()] = true;\n        }\n      }\n\n      if (has.first && has.third && has.fifth && has.seventh) {\n        name = 'tetrad';\n      }\n    }\n\n    return name || 'unknown';\n  },\n\n  get: function(interval) {\n    if (typeof interval === 'string' && interval in knowledge.stepNumber) {\n      var intervals = this.intervals, i, length;\n\n      interval = knowledge.stepNumber[interval];\n      for (i = 0, length = intervals.length; i < length; i++) {\n        if (intervals[i].number() === interval) {\n          return this.root.interval(intervals[i]);\n        }\n      }\n\n      return null;\n    } else {\n      throw new Error('Invalid interval name');\n    }\n  },\n\n  interval: function(interval) {\n    return new Chord(this.root.interval(interval), this.symbol);\n  },\n\n  transpose: function(interval) {\n    this.root.transpose(interval);\n    this.name = this.root.name().toUpperCase() +\n                this.root.accidental() + this.symbol;\n\n    return this;\n  },\n\n  toString: function() {\n    return this.name;\n  }\n};\n\nmodule.exports = Chord;\n"]},"metadata":{},"sourceType":"script"}