{"ast":null,"code":"export var createEvaluateSource = function createEvaluateSource(window) {\n  return function (source) {\n    return new Promise(function (resolve, reject) {\n      if (window === null) {\n        // Bug #182 Chrome, Edge and Opera do throw an instance of a SyntaxError instead of a DOMException.\n        reject(new SyntaxError());\n        return;\n      }\n\n      var head = window.document.head;\n\n      if (head === null) {\n        // Bug #182 Chrome, Edge and Opera do throw an instance of a SyntaxError instead of a DOMException.\n        reject(new SyntaxError());\n      } else {\n        var script = window.document.createElement('script'); // @todo Safari doesn't like URLs with a type of 'application/javascript; charset=utf-8'.\n\n        var blob = new Blob([source], {\n          type: 'application/javascript'\n        });\n        var url = URL.createObjectURL(blob);\n        var originalOnErrorHandler = window.onerror;\n\n        var removeErrorEventListenerAndRevokeUrl = function removeErrorEventListenerAndRevokeUrl() {\n          window.onerror = originalOnErrorHandler;\n          URL.revokeObjectURL(url);\n        };\n\n        window.onerror = function (message, src, lineno, colno, error) {\n          // @todo Edge thinks the source is the one of the html document.\n          if (src === url || src === window.location.href && lineno === 1 && colno === 1) {\n            removeErrorEventListenerAndRevokeUrl();\n            reject(error);\n            return false;\n          }\n\n          if (originalOnErrorHandler !== null) {\n            return originalOnErrorHandler(message, src, lineno, colno, error);\n          }\n        };\n\n        script.onerror = function () {\n          removeErrorEventListenerAndRevokeUrl(); // Bug #182 Chrome, Edge and Opera do throw an instance of a SyntaxError instead of a DOMException.\n\n          reject(new SyntaxError());\n        };\n\n        script.onload = function () {\n          removeErrorEventListenerAndRevokeUrl();\n          resolve();\n        };\n\n        script.src = url;\n        script.type = 'module';\n        head.appendChild(script);\n      }\n    });\n  };\n};","map":{"version":3,"sources":["../../../src/factories/evaluate-source.ts"],"names":[],"mappings":"AAEA,OAAO,IAAM,oBAAoB,GAA2B,SAA/C,oBAA+C,CAAC,MAAD,EAAW;AACnE,SAAO,UAAC,MAAD;AAAA,WACH,IAAI,OAAJ,CAAY,UAAC,OAAD,EAAU,MAAV,EAAoB;AAC5B,UAAI,MAAM,KAAK,IAAf,EAAqB;AACjB;AACA,QAAA,MAAM,CAAC,IAAI,WAAJ,EAAD,CAAN;AAEA;AACH;;AAED,UAAM,IAAI,GAAG,MAAM,CAAC,QAAP,CAAgB,IAA7B;;AAEA,UAAI,IAAI,KAAK,IAAb,EAAmB;AACf;AACA,QAAA,MAAM,CAAC,IAAI,WAAJ,EAAD,CAAN;AACH,OAHD,MAGO;AACH,YAAM,MAAM,GAAG,MAAM,CAAC,QAAP,CAAgB,aAAhB,CAA8B,QAA9B,CAAf,CADG,CAEH;;AACA,YAAM,IAAI,GAAG,IAAI,IAAJ,CAAS,CAAC,MAAD,CAAT,EAAmB;AAAE,UAAA,IAAI,EAAE;AAAR,SAAnB,CAAb;AACA,YAAM,GAAG,GAAG,GAAG,CAAC,eAAJ,CAAoB,IAApB,CAAZ;AAEA,YAAM,sBAAsB,GAAG,MAAM,CAAC,OAAtC;;AAEA,YAAM,oCAAoC,GAAG,SAAvC,oCAAuC,GAAK;AAC9C,UAAA,MAAM,CAAC,OAAP,GAAiB,sBAAjB;AAEA,UAAA,GAAG,CAAC,eAAJ,CAAoB,GAApB;AACH,SAJD;;AAMA,QAAA,MAAM,CAAC,OAAP,GAAiB,UAAC,OAAD,EAAU,GAAV,EAAe,MAAf,EAAuB,KAAvB,EAA8B,KAA9B,EAAuC;AACpD;AACA,cAAI,GAAG,KAAK,GAAR,IAAgB,GAAG,KAAK,MAAM,CAAC,QAAP,CAAgB,IAAxB,IAAgC,MAAM,KAAK,CAA3C,IAAgD,KAAK,KAAK,CAA9E,EAAkF;AAC9E,YAAA,oCAAoC;AACpC,YAAA,MAAM,CAAC,KAAD,CAAN;AAEA,mBAAO,KAAP;AACH;;AAED,cAAI,sBAAsB,KAAK,IAA/B,EAAqC;AACjC,mBAAO,sBAAsB,CAAC,OAAD,EAAU,GAAV,EAAe,MAAf,EAAuB,KAAvB,EAA8B,KAA9B,CAA7B;AACH;AACJ,SAZD;;AAcA,QAAA,MAAM,CAAC,OAAP,GAAiB,YAAK;AAClB,UAAA,oCAAoC,GADlB,CAElB;;AACA,UAAA,MAAM,CAAC,IAAI,WAAJ,EAAD,CAAN;AACH,SAJD;;AAKA,QAAA,MAAM,CAAC,MAAP,GAAgB,YAAK;AACjB,UAAA,oCAAoC;AACpC,UAAA,OAAO;AACV,SAHD;;AAIA,QAAA,MAAM,CAAC,GAAP,GAAa,GAAb;AACA,QAAA,MAAM,CAAC,IAAP,GAAc,QAAd;AAEA,QAAA,IAAI,CAAC,WAAL,CAAiB,MAAjB;AACH;AACJ,KAvDD,CADG;AAAA,GAAP;AAyDH,CA1DM","sourceRoot":"","sourcesContent":["export const createEvaluateSource = (window) => {\n    return (source) => new Promise((resolve, reject) => {\n        if (window === null) {\n            // Bug #182 Chrome, Edge and Opera do throw an instance of a SyntaxError instead of a DOMException.\n            reject(new SyntaxError());\n            return;\n        }\n        const head = window.document.head;\n        if (head === null) {\n            // Bug #182 Chrome, Edge and Opera do throw an instance of a SyntaxError instead of a DOMException.\n            reject(new SyntaxError());\n        }\n        else {\n            const script = window.document.createElement('script');\n            // @todo Safari doesn't like URLs with a type of 'application/javascript; charset=utf-8'.\n            const blob = new Blob([source], { type: 'application/javascript' });\n            const url = URL.createObjectURL(blob);\n            const originalOnErrorHandler = window.onerror;\n            const removeErrorEventListenerAndRevokeUrl = () => {\n                window.onerror = originalOnErrorHandler;\n                URL.revokeObjectURL(url);\n            };\n            window.onerror = (message, src, lineno, colno, error) => {\n                // @todo Edge thinks the source is the one of the html document.\n                if (src === url || (src === window.location.href && lineno === 1 && colno === 1)) {\n                    removeErrorEventListenerAndRevokeUrl();\n                    reject(error);\n                    return false;\n                }\n                if (originalOnErrorHandler !== null) {\n                    return originalOnErrorHandler(message, src, lineno, colno, error);\n                }\n            };\n            script.onerror = () => {\n                removeErrorEventListenerAndRevokeUrl();\n                // Bug #182 Chrome, Edge and Opera do throw an instance of a SyntaxError instead of a DOMException.\n                reject(new SyntaxError());\n            };\n            script.onload = () => {\n                removeErrorEventListenerAndRevokeUrl();\n                resolve();\n            };\n            script.src = url;\n            script.type = 'module';\n            head.appendChild(script);\n        }\n    });\n};\n//# sourceMappingURL=evaluate-source.js.map"]},"metadata":{},"sourceType":"module"}