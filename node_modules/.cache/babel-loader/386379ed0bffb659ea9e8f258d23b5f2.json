{"ast":null,"code":"var WebGLManager = require('./WebGLManager'),\n    utils = require('../../../utils');\n/**\n * @class\n * @memberof PIXI\n * @param renderer {WebGLRenderer} The renderer this manager works for.\n */\n\n\nfunction WebGLMaskManager(renderer) {\n  WebGLManager.call(this, renderer);\n  this.stencilMaskStack = null;\n}\n\nWebGLMaskManager.prototype = Object.create(WebGLManager.prototype);\nWebGLMaskManager.prototype.constructor = WebGLMaskManager;\nmodule.exports = WebGLMaskManager;\n/**\n * Changes the mask stack that is used by this manager\n * @param stencilMaskStack {StencilMaskStack} The mask stack \n *\n */\n\nWebGLMaskManager.prototype.setMaskStack = function (stencilMaskStack) {\n  this.stencilMaskStack = stencilMaskStack;\n  var gl = this.renderer.gl;\n\n  if (stencilMaskStack.stencilStack.length === 0) {\n    gl.disable(gl.STENCIL_TEST);\n  } else {\n    gl.enable(gl.STENCIL_TEST);\n  }\n};\n/**\n * Applies the Mask and adds it to the current filter stack. @alvin\n * \n * @param graphics {Graphics}\n * @param webGLData {any[]}\n */\n\n\nWebGLMaskManager.prototype.pushStencil = function (graphics, webGLData) {\n  this.renderer.currentRenderTarget.attachStencilBuffer();\n  var gl = this.renderer.gl,\n      sms = this.stencilMaskStack;\n  this.bindGraphics(graphics, webGLData, this.renderer);\n\n  if (sms.stencilStack.length === 0) {\n    gl.enable(gl.STENCIL_TEST);\n    gl.clear(gl.STENCIL_BUFFER_BIT);\n    sms.reverse = true;\n    sms.count = 0;\n  }\n\n  sms.stencilStack.push(webGLData);\n  var level = sms.count;\n  gl.colorMask(false, false, false, false);\n  gl.stencilFunc(gl.ALWAYS, 0, 0xFF);\n  gl.stencilOp(gl.KEEP, gl.KEEP, gl.INVERT); // draw the triangle strip!\n\n  if (webGLData.mode === 1) {\n    gl.drawElements(gl.TRIANGLE_FAN, webGLData.indices.length - 4, gl.UNSIGNED_SHORT, 0);\n\n    if (sms.reverse) {\n      gl.stencilFunc(gl.EQUAL, 0xFF - level, 0xFF);\n      gl.stencilOp(gl.KEEP, gl.KEEP, gl.DECR);\n    } else {\n      gl.stencilFunc(gl.EQUAL, level, 0xFF);\n      gl.stencilOp(gl.KEEP, gl.KEEP, gl.INCR);\n    } // draw a quad to increment..\n\n\n    gl.drawElements(gl.TRIANGLE_FAN, 4, gl.UNSIGNED_SHORT, (webGLData.indices.length - 4) * 2);\n\n    if (sms.reverse) {\n      gl.stencilFunc(gl.EQUAL, 0xFF - (level + 1), 0xFF);\n    } else {\n      gl.stencilFunc(gl.EQUAL, level + 1, 0xFF);\n    }\n\n    sms.reverse = !sms.reverse;\n  } else {\n    if (!sms.reverse) {\n      gl.stencilFunc(gl.EQUAL, 0xFF - level, 0xFF);\n      gl.stencilOp(gl.KEEP, gl.KEEP, gl.DECR);\n    } else {\n      gl.stencilFunc(gl.EQUAL, level, 0xFF);\n      gl.stencilOp(gl.KEEP, gl.KEEP, gl.INCR);\n    }\n\n    gl.drawElements(gl.TRIANGLE_STRIP, webGLData.indices.length, gl.UNSIGNED_SHORT, 0);\n\n    if (!sms.reverse) {\n      gl.stencilFunc(gl.EQUAL, 0xFF - (level + 1), 0xFF);\n    } else {\n      gl.stencilFunc(gl.EQUAL, level + 1, 0xFF);\n    }\n  }\n\n  gl.colorMask(true, true, true, true);\n  gl.stencilOp(gl.KEEP, gl.KEEP, gl.KEEP);\n  sms.count++;\n};\n/**\n * TODO this does not belong here!\n *\n * @param graphics {Graphics}\n * @param webGLData {Array}\n */\n\n\nWebGLMaskManager.prototype.bindGraphics = function (graphics, webGLData) {\n  //if (this._currentGraphics === graphics)return;\n  this._currentGraphics = graphics;\n  var gl = this.renderer.gl; // bind the graphics object..\n\n  var shader; // = this.renderer.shaderManager.plugins.primitiveShader;\n\n  if (webGLData.mode === 1) {\n    shader = this.renderer.shaderManager.complexPrimitiveShader;\n    this.renderer.shaderManager.setShader(shader);\n    gl.uniformMatrix3fv(shader.uniforms.translationMatrix._location, false, graphics.worldTransform.toArray(true));\n    gl.uniformMatrix3fv(shader.uniforms.projectionMatrix._location, false, this.renderer.currentRenderTarget.projectionMatrix.toArray(true));\n    gl.uniform3fv(shader.uniforms.tint._location, utils.hex2rgb(graphics.tint));\n    gl.uniform3fv(shader.uniforms.color._location, webGLData.color);\n    gl.uniform1f(shader.uniforms.alpha._location, graphics.worldAlpha);\n    gl.bindBuffer(gl.ARRAY_BUFFER, webGLData.buffer);\n    gl.vertexAttribPointer(shader.attributes.aVertexPosition, 2, gl.FLOAT, false, 4 * 2, 0); // now do the rest..\n    // set the index buffer!\n\n    gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, webGLData.indexBuffer);\n  } else {\n    //this.renderer.shaderManager.activatePrimitiveShader();\n    shader = this.renderer.shaderManager.primitiveShader;\n    this.renderer.shaderManager.setShader(shader);\n    gl.uniformMatrix3fv(shader.uniforms.translationMatrix._location, false, graphics.worldTransform.toArray(true));\n    gl.uniformMatrix3fv(shader.uniforms.projectionMatrix._location, false, this.renderer.currentRenderTarget.projectionMatrix.toArray(true));\n    gl.uniform3fv(shader.uniforms.tint._location, utils.hex2rgb(graphics.tint));\n    gl.uniform1f(shader.uniforms.alpha._location, graphics.worldAlpha);\n    gl.bindBuffer(gl.ARRAY_BUFFER, webGLData.buffer);\n    gl.vertexAttribPointer(shader.attributes.aVertexPosition, 2, gl.FLOAT, false, 4 * 6, 0);\n    gl.vertexAttribPointer(shader.attributes.aColor, 4, gl.FLOAT, false, 4 * 6, 2 * 4); // set the index buffer!\n\n    gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, webGLData.indexBuffer);\n  }\n};\n/**\n * TODO @alvin\n * @param graphics {Graphics}\n * @param webGLData {Array}\n */\n\n\nWebGLMaskManager.prototype.popStencil = function (graphics, webGLData) {\n  var gl = this.renderer.gl,\n      sms = this.stencilMaskStack;\n  sms.stencilStack.pop();\n  sms.count--;\n\n  if (sms.stencilStack.length === 0) {\n    // the stack is empty!\n    gl.disable(gl.STENCIL_TEST);\n  } else {\n    var level = sms.count;\n    this.bindGraphics(graphics, webGLData, this.renderer);\n    gl.colorMask(false, false, false, false);\n\n    if (webGLData.mode === 1) {\n      sms.reverse = !sms.reverse;\n\n      if (sms.reverse) {\n        gl.stencilFunc(gl.EQUAL, 0xFF - (level + 1), 0xFF);\n        gl.stencilOp(gl.KEEP, gl.KEEP, gl.INCR);\n      } else {\n        gl.stencilFunc(gl.EQUAL, level + 1, 0xFF);\n        gl.stencilOp(gl.KEEP, gl.KEEP, gl.DECR);\n      } // draw a quad to increment..\n\n\n      gl.drawElements(gl.TRIANGLE_FAN, 4, gl.UNSIGNED_SHORT, (webGLData.indices.length - 4) * 2);\n      gl.stencilFunc(gl.ALWAYS, 0, 0xFF);\n      gl.stencilOp(gl.KEEP, gl.KEEP, gl.INVERT); // draw the triangle strip!\n\n      gl.drawElements(gl.TRIANGLE_FAN, webGLData.indices.length - 4, gl.UNSIGNED_SHORT, 0);\n\n      if (!sms.reverse) {\n        gl.stencilFunc(gl.EQUAL, 0xFF - level, 0xFF);\n      } else {\n        gl.stencilFunc(gl.EQUAL, level, 0xFF);\n      }\n    } else {\n      //  console.log(\"<<>>\")\n      if (!sms.reverse) {\n        gl.stencilFunc(gl.EQUAL, 0xFF - (level + 1), 0xFF);\n        gl.stencilOp(gl.KEEP, gl.KEEP, gl.INCR);\n      } else {\n        gl.stencilFunc(gl.EQUAL, level + 1, 0xFF);\n        gl.stencilOp(gl.KEEP, gl.KEEP, gl.DECR);\n      }\n\n      gl.drawElements(gl.TRIANGLE_STRIP, webGLData.indices.length, gl.UNSIGNED_SHORT, 0);\n\n      if (!sms.reverse) {\n        gl.stencilFunc(gl.EQUAL, 0xFF - level, 0xFF);\n      } else {\n        gl.stencilFunc(gl.EQUAL, level, 0xFF);\n      }\n    }\n\n    gl.colorMask(true, true, true, true);\n    gl.stencilOp(gl.KEEP, gl.KEEP, gl.KEEP);\n  }\n};\n/**\n * Destroys the mask stack.\n *\n */\n\n\nWebGLMaskManager.prototype.destroy = function () {\n  WebGLManager.prototype.destroy.call(this);\n  this.stencilMaskStack.stencilStack = null;\n};\n/**\n * Applies the Mask and adds it to the current filter stack.\n *\n * @param maskData {any[]} The mask data structure to use\n */\n\n\nWebGLMaskManager.prototype.pushMask = function (maskData) {\n  this.renderer.setObjectRenderer(this.renderer.plugins.graphics);\n\n  if (maskData.dirty) {\n    this.renderer.plugins.graphics.updateGraphics(maskData, this.renderer.gl);\n  }\n\n  if (!maskData._webGL[this.renderer.gl.id].data.length) {\n    return;\n  }\n\n  this.pushStencil(maskData, maskData._webGL[this.renderer.gl.id].data[0], this.renderer);\n};\n/**\n * Removes the last filter from the filter stack and doesn't return it.\n *\n * @param maskData {any[]}\n */\n\n\nWebGLMaskManager.prototype.popMask = function (maskData) {\n  this.renderer.setObjectRenderer(this.renderer.plugins.graphics);\n  this.popStencil(maskData, maskData._webGL[this.renderer.gl.id].data[0], this.renderer);\n};","map":{"version":3,"sources":["/Users/thebe/Desktop/music-generator-app/node_modules/pixi.js/src/core/renderers/webgl/managers/StencilManager.js"],"names":["WebGLManager","require","utils","WebGLMaskManager","renderer","call","stencilMaskStack","prototype","Object","create","constructor","module","exports","setMaskStack","gl","stencilStack","length","disable","STENCIL_TEST","enable","pushStencil","graphics","webGLData","currentRenderTarget","attachStencilBuffer","sms","bindGraphics","clear","STENCIL_BUFFER_BIT","reverse","count","push","level","colorMask","stencilFunc","ALWAYS","stencilOp","KEEP","INVERT","mode","drawElements","TRIANGLE_FAN","indices","UNSIGNED_SHORT","EQUAL","DECR","INCR","TRIANGLE_STRIP","_currentGraphics","shader","shaderManager","complexPrimitiveShader","setShader","uniformMatrix3fv","uniforms","translationMatrix","_location","worldTransform","toArray","projectionMatrix","uniform3fv","tint","hex2rgb","color","uniform1f","alpha","worldAlpha","bindBuffer","ARRAY_BUFFER","buffer","vertexAttribPointer","attributes","aVertexPosition","FLOAT","ELEMENT_ARRAY_BUFFER","indexBuffer","primitiveShader","aColor","popStencil","pop","destroy","pushMask","maskData","setObjectRenderer","plugins","dirty","updateGraphics","_webGL","id","data","popMask"],"mappings":"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","sourcesContent":["var WebGLManager = require('./WebGLManager'),\n    utils = require('../../../utils');\n\n/**\n * @class\n * @memberof PIXI\n * @param renderer {WebGLRenderer} The renderer this manager works for.\n */\nfunction WebGLMaskManager(renderer)\n{\n    WebGLManager.call(this, renderer);\n    this.stencilMaskStack = null;\n}\n\nWebGLMaskManager.prototype = Object.create(WebGLManager.prototype);\nWebGLMaskManager.prototype.constructor = WebGLMaskManager;\nmodule.exports = WebGLMaskManager;\n\n/**\n * Changes the mask stack that is used by this manager\n * @param stencilMaskStack {StencilMaskStack} The mask stack \n *\n */\nWebGLMaskManager.prototype.setMaskStack = function ( stencilMaskStack )\n{\n    this.stencilMaskStack = stencilMaskStack;\n\n    var gl = this.renderer.gl;\n\n    if (stencilMaskStack.stencilStack.length === 0)\n    {\n        gl.disable(gl.STENCIL_TEST);\n    }\n    else\n    {\n        gl.enable(gl.STENCIL_TEST);\n    }\n};\n\n/**\n * Applies the Mask and adds it to the current filter stack. @alvin\n * \n * @param graphics {Graphics}\n * @param webGLData {any[]}\n */\nWebGLMaskManager.prototype.pushStencil = function (graphics, webGLData)\n{\n    this.renderer.currentRenderTarget.attachStencilBuffer();\n\n    var gl = this.renderer.gl,\n        sms = this.stencilMaskStack;\n\n    this.bindGraphics(graphics, webGLData, this.renderer);\n\n    if (sms.stencilStack.length === 0)\n    {\n        gl.enable(gl.STENCIL_TEST);\n        gl.clear(gl.STENCIL_BUFFER_BIT);\n        sms.reverse = true;\n        sms.count = 0;\n    }\n\n    sms.stencilStack.push(webGLData);\n\n    var level = sms.count;\n\n    gl.colorMask(false, false, false, false);\n\n    gl.stencilFunc(gl.ALWAYS,0,0xFF);\n    gl.stencilOp(gl.KEEP,gl.KEEP,gl.INVERT);\n\n    // draw the triangle strip!\n\n    if (webGLData.mode === 1)\n    {\n        gl.drawElements(gl.TRIANGLE_FAN,  webGLData.indices.length - 4, gl.UNSIGNED_SHORT, 0 );\n\n        if (sms.reverse)\n        {\n            gl.stencilFunc(gl.EQUAL, 0xFF - level, 0xFF);\n            gl.stencilOp(gl.KEEP,gl.KEEP,gl.DECR);\n        }\n        else\n        {\n            gl.stencilFunc(gl.EQUAL,level, 0xFF);\n            gl.stencilOp(gl.KEEP,gl.KEEP,gl.INCR);\n        }\n\n        // draw a quad to increment..\n        gl.drawElements(gl.TRIANGLE_FAN, 4, gl.UNSIGNED_SHORT, ( webGLData.indices.length - 4 ) * 2 );\n\n        if (sms.reverse)\n        {\n            gl.stencilFunc(gl.EQUAL,0xFF-(level+1), 0xFF);\n        }\n        else\n        {\n            gl.stencilFunc(gl.EQUAL,level+1, 0xFF);\n        }\n\n        sms.reverse = !sms.reverse;\n    }\n    else\n    {\n        if (!sms.reverse)\n        {\n            gl.stencilFunc(gl.EQUAL, 0xFF - level, 0xFF);\n            gl.stencilOp(gl.KEEP,gl.KEEP,gl.DECR);\n        }\n        else\n        {\n            gl.stencilFunc(gl.EQUAL,level, 0xFF);\n            gl.stencilOp(gl.KEEP,gl.KEEP,gl.INCR);\n        }\n\n        gl.drawElements(gl.TRIANGLE_STRIP,  webGLData.indices.length, gl.UNSIGNED_SHORT, 0 );\n\n        if (!sms.reverse)\n        {\n            gl.stencilFunc(gl.EQUAL,0xFF-(level+1), 0xFF);\n        }\n        else\n        {\n            gl.stencilFunc(gl.EQUAL,level+1, 0xFF);\n        }\n    }\n\n    gl.colorMask(true, true, true, true);\n    gl.stencilOp(gl.KEEP,gl.KEEP,gl.KEEP);\n\n    sms.count++;\n};\n\n/**\n * TODO this does not belong here!\n *\n * @param graphics {Graphics}\n * @param webGLData {Array}\n */\nWebGLMaskManager.prototype.bindGraphics = function (graphics, webGLData)\n{\n    //if (this._currentGraphics === graphics)return;\n    this._currentGraphics = graphics;\n\n    var gl = this.renderer.gl;\n\n     // bind the graphics object..\n    var shader;// = this.renderer.shaderManager.plugins.primitiveShader;\n\n    if (webGLData.mode === 1)\n    {\n        shader = this.renderer.shaderManager.complexPrimitiveShader;\n\n        this.renderer.shaderManager.setShader(shader);\n\n        gl.uniformMatrix3fv(shader.uniforms.translationMatrix._location, false, graphics.worldTransform.toArray(true));\n\n        gl.uniformMatrix3fv(shader.uniforms.projectionMatrix._location, false, this.renderer.currentRenderTarget.projectionMatrix.toArray(true));\n\n        gl.uniform3fv(shader.uniforms.tint._location, utils.hex2rgb(graphics.tint));\n\n        gl.uniform3fv(shader.uniforms.color._location, webGLData.color);\n\n        gl.uniform1f(shader.uniforms.alpha._location, graphics.worldAlpha);\n\n        gl.bindBuffer(gl.ARRAY_BUFFER, webGLData.buffer);\n\n        gl.vertexAttribPointer(shader.attributes.aVertexPosition, 2, gl.FLOAT, false, 4 * 2, 0);\n\n\n        // now do the rest..\n        // set the index buffer!\n        gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, webGLData.indexBuffer);\n    }\n    else\n    {\n        //this.renderer.shaderManager.activatePrimitiveShader();\n        shader = this.renderer.shaderManager.primitiveShader;\n\n        this.renderer.shaderManager.setShader( shader );\n\n        gl.uniformMatrix3fv(shader.uniforms.translationMatrix._location, false, graphics.worldTransform.toArray(true));\n\n        gl.uniformMatrix3fv(shader.uniforms.projectionMatrix._location, false, this.renderer.currentRenderTarget.projectionMatrix.toArray(true));\n\n        gl.uniform3fv(shader.uniforms.tint._location, utils.hex2rgb(graphics.tint));\n\n        gl.uniform1f(shader.uniforms.alpha._location, graphics.worldAlpha);\n\n        gl.bindBuffer(gl.ARRAY_BUFFER, webGLData.buffer);\n\n        gl.vertexAttribPointer(shader.attributes.aVertexPosition, 2, gl.FLOAT, false, 4 * 6, 0);\n        gl.vertexAttribPointer(shader.attributes.aColor, 4, gl.FLOAT, false,4 * 6, 2 * 4);\n\n        // set the index buffer!\n        gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, webGLData.indexBuffer);\n    }\n};\n\n/**\n * TODO @alvin\n * @param graphics {Graphics}\n * @param webGLData {Array}\n */\nWebGLMaskManager.prototype.popStencil = function (graphics, webGLData)\n{\n    var gl = this.renderer.gl,\n        sms = this.stencilMaskStack;\n\n    sms.stencilStack.pop();\n\n    sms.count--;\n\n    if (sms.stencilStack.length === 0)\n    {\n        // the stack is empty!\n        gl.disable(gl.STENCIL_TEST);\n\n    }\n    else\n    {\n\n        var level = sms.count;\n\n        this.bindGraphics(graphics, webGLData, this.renderer);\n\n        gl.colorMask(false, false, false, false);\n\n        if (webGLData.mode === 1)\n        {\n            sms.reverse = !sms.reverse;\n\n            if (sms.reverse)\n            {\n                gl.stencilFunc(gl.EQUAL, 0xFF - (level+1), 0xFF);\n                gl.stencilOp(gl.KEEP,gl.KEEP,gl.INCR);\n            }\n            else\n            {\n                gl.stencilFunc(gl.EQUAL,level+1, 0xFF);\n                gl.stencilOp(gl.KEEP,gl.KEEP,gl.DECR);\n            }\n\n            // draw a quad to increment..\n            gl.drawElements(gl.TRIANGLE_FAN, 4, gl.UNSIGNED_SHORT, ( webGLData.indices.length - 4 ) * 2 );\n\n            gl.stencilFunc(gl.ALWAYS,0,0xFF);\n            gl.stencilOp(gl.KEEP,gl.KEEP,gl.INVERT);\n\n            // draw the triangle strip!\n            gl.drawElements(gl.TRIANGLE_FAN,  webGLData.indices.length - 4, gl.UNSIGNED_SHORT, 0 );\n\n            if (!sms.reverse)\n            {\n                gl.stencilFunc(gl.EQUAL,0xFF-(level), 0xFF);\n            }\n            else\n            {\n                gl.stencilFunc(gl.EQUAL,level, 0xFF);\n            }\n\n        }\n        else\n        {\n          //  console.log(\"<<>>\")\n            if (!sms.reverse)\n            {\n                gl.stencilFunc(gl.EQUAL, 0xFF - (level+1), 0xFF);\n                gl.stencilOp(gl.KEEP,gl.KEEP,gl.INCR);\n            }\n            else\n            {\n                gl.stencilFunc(gl.EQUAL,level+1, 0xFF);\n                gl.stencilOp(gl.KEEP,gl.KEEP,gl.DECR);\n            }\n\n            gl.drawElements(gl.TRIANGLE_STRIP,  webGLData.indices.length, gl.UNSIGNED_SHORT, 0 );\n\n            if (!sms.reverse)\n            {\n                gl.stencilFunc(gl.EQUAL,0xFF-(level), 0xFF);\n            }\n            else\n            {\n                gl.stencilFunc(gl.EQUAL,level, 0xFF);\n            }\n        }\n\n        gl.colorMask(true, true, true, true);\n        gl.stencilOp(gl.KEEP,gl.KEEP,gl.KEEP);\n\n\n    }\n};\n\n/**\n * Destroys the mask stack.\n *\n */\nWebGLMaskManager.prototype.destroy = function ()\n{\n    WebGLManager.prototype.destroy.call(this);\n\n    this.stencilMaskStack.stencilStack = null;\n};\n\n/**\n * Applies the Mask and adds it to the current filter stack.\n *\n * @param maskData {any[]} The mask data structure to use\n */\nWebGLMaskManager.prototype.pushMask = function (maskData)\n{\n\n\n    this.renderer.setObjectRenderer(this.renderer.plugins.graphics);\n\n    if (maskData.dirty)\n    {\n        this.renderer.plugins.graphics.updateGraphics(maskData, this.renderer.gl);\n    }\n\n    if (!maskData._webGL[this.renderer.gl.id].data.length)\n    {\n        return;\n    }\n\n    this.pushStencil(maskData, maskData._webGL[this.renderer.gl.id].data[0], this.renderer);\n};\n\n/**\n * Removes the last filter from the filter stack and doesn't return it.\n *\n * @param maskData {any[]}\n */\nWebGLMaskManager.prototype.popMask = function (maskData)\n{\n    this.renderer.setObjectRenderer(this.renderer.plugins.graphics);\n\n    this.popStencil(maskData, maskData._webGL[this.renderer.gl.id].data[0], this.renderer);\n};\n\n"]},"metadata":{},"sourceType":"script"}